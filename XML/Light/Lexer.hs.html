<!DOCTYPE html>
<html>
<head>
  <meta http-equiv="content-type" content="text/html;charset=utf-8">
  <title> documentation: XML/Light/Lexer.hs</title>
  <link rel="stylesheet" href="../../pyccoon.css">
</head>
<body>
<div id='container' >
  <div id="footer">
    <span id="project-name">
        <a class="btn" href="../../index.html"> documentation</a>
    </span>
    <a class="btn" class="source source-1" href="#top">Back to top</a>
    <div id="jump_to" class="btn">
    Contents
    <div id="jump_wrapper">
      <div id="jump_page">
          <a class="source source-2" href="#lexer"> Lexer </a>
      </div>
    </div>
    </div>
    <div class="generation-time">
        Generated at
        <code>2015-06-21 20:44</code>
        by a diligent
        <a target="_blank" href="http://ckald.github.io/pyccoon/" title="Pyccoon: side-to-side documentation generator">
            <img id="pyccoon-icon" src="../../pyccoon_icon.svg" alt="Pyccoon: side-to-side documentation generator" />pyccoon</a>
    </div>
  </div>
  <a id="top"></a>
  <div class='section'>
    <div class='docs nav'>
      <nav id="breadcrumbs">/ <a href="Lexer.hs.html/../../../index.html">.</a> / <a href="Lexer.hs.html/../../index.html">XML</a> / <a href="Lexer.hs.html/../index.html">Light</a> / Lexer.hs</nav>
      <ul id="children"></ul>
    </div>
  </div>
  <div id="everything" class='clearall'>
    <div id="background"></div>
    <div class='section'>
    <a id="section-0" class="section-anchor"></a>
    <section>
        <div class='docs'>
          <div class='octowrap'>
            <a class='octothorpe' href='#section-0'>#</a>
          </div>
          
        </div>
        <div class='code'>
          <div class="highlight"><pre><span class="cm">{-# LANGUAGE TypeSynonymInstances #-}</span>

<span class="kr">module</span> <span class="nn">Text.XML.Light.Lexer</span> <span class="kr">where</span>

<span class="kr">import</span> <span class="nn">Text.XML.Light.Types</span>

<span class="kr">import</span> <span class="nn">Data.Char</span> <span class="p">(</span><span class="nf">chr</span><span class="p">,</span><span class="nf">isSpace</span><span class="p">)</span>
<span class="kr">import</span> <span class="nn">Numeric</span> <span class="p">(</span><span class="nf">readHex</span><span class="p">)</span>
<span class="kr">import</span> <span class="k">qualified</span> <span class="nn">Data.ByteString</span>      <span class="k">as</span> <span class="n">S</span>
<span class="kr">import</span> <span class="k">qualified</span> <span class="nn">Data.ByteString.Lazy</span> <span class="k">as</span> <span class="n">L</span>
<span class="kr">import</span> <span class="k">qualified</span> <span class="nn">Data.Text</span>            <span class="k">as</span> <span class="n">TS</span>
<span class="kr">import</span> <span class="k">qualified</span> <span class="nn">Data.Text.Lazy</span>       <span class="k">as</span> <span class="n">TL</span>


<span class="kr">class</span> <span class="kt">XmlSource</span> <span class="n">s</span> <span class="kr">where</span>
  <span class="n">uncons</span> <span class="ow">::</span> <span class="n">s</span> <span class="ow">-&gt;</span> <span class="kt">Maybe</span> <span class="p">(</span><span class="kt">Char</span><span class="p">,</span><span class="n">s</span><span class="p">)</span>

<span class="kr">instance</span> <span class="kt">XmlSource</span> <span class="kt">String</span> <span class="kr">where</span>
  <span class="n">uncons</span> <span class="p">(</span><span class="n">c</span><span class="kt">:</span><span class="n">s</span><span class="p">)</span> <span class="ow">=</span> <span class="kt">Just</span> <span class="p">(</span><span class="n">c</span><span class="p">,</span><span class="n">s</span><span class="p">)</span>
  <span class="n">uncons</span> <span class="s">&quot;&quot;</span>    <span class="ow">=</span> <span class="kt">Nothing</span>

<span class="kr">instance</span> <span class="kt">XmlSource</span> <span class="kt">S</span><span class="o">.</span><span class="kt">ByteString</span> <span class="kr">where</span>
  <span class="n">uncons</span> <span class="n">bs</span> <span class="ow">=</span> <span class="n">f</span> <span class="p">`</span><span class="n">fmap</span><span class="p">`</span> <span class="kt">S</span><span class="o">.</span><span class="n">uncons</span> <span class="n">bs</span>
    <span class="kr">where</span> <span class="n">f</span> <span class="p">(</span><span class="n">c</span><span class="p">,</span><span class="n">s</span><span class="p">)</span> <span class="ow">=</span> <span class="p">(</span><span class="n">chr</span> <span class="p">(</span><span class="n">fromEnum</span> <span class="n">c</span><span class="p">),</span> <span class="n">s</span><span class="p">)</span>

<span class="kr">instance</span> <span class="kt">XmlSource</span> <span class="kt">L</span><span class="o">.</span><span class="kt">ByteString</span> <span class="kr">where</span>
  <span class="n">uncons</span> <span class="n">bs</span> <span class="ow">=</span> <span class="n">f</span> <span class="p">`</span><span class="n">fmap</span><span class="p">`</span> <span class="kt">L</span><span class="o">.</span><span class="n">uncons</span> <span class="n">bs</span>
    <span class="kr">where</span> <span class="n">f</span> <span class="p">(</span><span class="n">c</span><span class="p">,</span><span class="n">s</span><span class="p">)</span> <span class="ow">=</span> <span class="p">(</span><span class="n">chr</span> <span class="p">(</span><span class="n">fromEnum</span> <span class="n">c</span><span class="p">),</span> <span class="n">s</span><span class="p">)</span>

<span class="kr">instance</span> <span class="kt">XmlSource</span> <span class="kt">TS</span><span class="o">.</span><span class="kt">Text</span> <span class="kr">where</span>
  <span class="n">uncons</span> <span class="ow">=</span> <span class="kt">TS</span><span class="o">.</span><span class="n">uncons</span>

<span class="kr">instance</span> <span class="kt">XmlSource</span> <span class="kt">TL</span><span class="o">.</span><span class="kt">Text</span> <span class="kr">where</span>
  <span class="n">uncons</span> <span class="ow">=</span> <span class="kt">TL</span><span class="o">.</span><span class="n">uncons</span>

<span class="nf">linenumber</span> <span class="ow">::</span> <span class="kt">XmlSource</span> <span class="n">s</span> <span class="ow">=&gt;</span> <span class="kt">Integer</span> <span class="ow">-&gt;</span> <span class="n">s</span> <span class="ow">-&gt;</span> <span class="kt">LString</span>
<span class="nf">linenumber</span> <span class="n">n</span> <span class="n">s</span> <span class="ow">=</span> <span class="kr">case</span> <span class="n">uncons</span> <span class="n">s</span> <span class="kr">of</span>
  <span class="kt">Nothing</span> <span class="ow">-&gt;</span> <span class="kt">[]</span>
  <span class="kt">Just</span> <span class="p">(</span><span class="sc">&#39;</span><span class="se">\r</span><span class="sc">&#39;</span><span class="p">,</span> <span class="n">s&#39;</span><span class="p">)</span>   <span class="ow">-&gt;</span> <span class="kr">case</span> <span class="n">uncons</span> <span class="n">s&#39;</span> <span class="kr">of</span>
    <span class="kt">Just</span> <span class="p">(</span><span class="sc">&#39;</span><span class="se">\n</span><span class="sc">&#39;</span><span class="p">,</span><span class="n">s&#39;&#39;</span><span class="p">)</span> <span class="ow">-&gt;</span> <span class="n">next</span> <span class="n">s&#39;&#39;</span>
    <span class="kr">_</span>               <span class="ow">-&gt;</span> <span class="n">next</span> <span class="n">s&#39;</span>
  <span class="kt">Just</span> <span class="p">(</span><span class="sc">&#39;</span><span class="se">\n</span><span class="sc">&#39;</span><span class="p">,</span> <span class="n">s&#39;</span><span class="p">)</span> <span class="ow">-&gt;</span> <span class="n">next</span> <span class="n">s&#39;</span>
  <span class="kt">Just</span> <span class="p">(</span><span class="n">c</span>   <span class="p">,</span> <span class="n">s&#39;</span><span class="p">)</span> <span class="ow">-&gt;</span> <span class="p">(</span><span class="n">n</span><span class="p">,</span><span class="n">c</span><span class="p">)</span> <span class="kt">:</span> <span class="n">linenumber</span> <span class="n">n</span> <span class="n">s&#39;</span>
  <span class="kr">where</span>
  <span class="n">next</span> <span class="n">s&#39;</span> <span class="ow">=</span> <span class="n">n&#39;</span> <span class="p">`</span><span class="n">seq</span><span class="p">`</span> <span class="p">((</span><span class="n">n</span><span class="p">,</span><span class="sc">&#39;</span><span class="se">\n</span><span class="sc">&#39;</span><span class="p">)</span><span class="kt">:</span><span class="n">linenumber</span> <span class="n">n&#39;</span> <span class="n">s&#39;</span><span class="p">)</span> <span class="kr">where</span> <span class="n">n&#39;</span> <span class="ow">=</span> <span class="n">n</span> <span class="o">+</span> <span class="mi">1</span></pre></div>
        </div>
        <div class='clearall'></div>
    </section>
    </div>
    <div class='section'>
    <a id="section-1" class="section-anchor"></a>
    <section>
        <div class='docs'>
          <div class='octowrap'>
            <a class='octothorpe' href='#section-1'>#</a>
          </div>
          <div class="haddock">
  <div class="haddock-header">
    Haddock:
  </div>
  <div class="haddock-text">
    <p>This type may be used to provide a custom scanning function for extracting characters.</p>

  </div>

</div>
        </div>
        <div class='code'>
          <div class="highlight"><pre><span class="kr">data</span> <span class="kt">Scanner</span> <span class="n">s</span> <span class="ow">=</span> <span class="kt">Scanner</span> <span class="p">(</span><span class="kt">Maybe</span> <span class="p">(</span><span class="kt">Char</span><span class="p">,</span><span class="n">s</span><span class="p">))</span> <span class="p">(</span><span class="n">s</span> <span class="ow">-&gt;</span> <span class="kt">Maybe</span> <span class="p">(</span><span class="kt">Char</span><span class="p">,</span><span class="n">s</span><span class="p">))</span></pre></div>
        </div>
        <div class='clearall'></div>
    </section>
    </div>
    <div class='section'>
    <a id="section-2" class="section-anchor"></a>
    <section>
        <div class='docs'>
          <div class='octowrap'>
            <a class='octothorpe' href='#section-2'>#</a>
          </div>
          <div class="haddock">
  <div class="haddock-header">
    Haddock:
  </div>
  <div class="haddock-text">
    <p>This type may be used to provide a custom scanning function for extracting characters.</p>

  </div>

</div>
        </div>
        <div class='code'>
          <div class="highlight"><pre><span class="nf">customScanner</span> <span class="ow">::</span> <span class="p">(</span><span class="n">s</span> <span class="ow">-&gt;</span> <span class="kt">Maybe</span> <span class="p">(</span><span class="kt">Char</span><span class="p">,</span><span class="n">s</span><span class="p">))</span> <span class="ow">-&gt;</span> <span class="n">s</span> <span class="ow">-&gt;</span> <span class="kt">Scanner</span> <span class="n">s</span>
<span class="nf">customScanner</span> <span class="n">next</span> <span class="n">s</span> <span class="ow">=</span> <span class="kt">Scanner</span> <span class="p">(</span><span class="n">next</span> <span class="n">s</span><span class="p">)</span> <span class="n">next</span>

<span class="kr">instance</span> <span class="kt">XmlSource</span> <span class="p">(</span><span class="kt">Scanner</span> <span class="n">s</span><span class="p">)</span> <span class="kr">where</span>
  <span class="n">uncons</span> <span class="p">(</span><span class="kt">Scanner</span> <span class="n">this</span> <span class="n">next</span><span class="p">)</span> <span class="ow">=</span> <span class="kr">do</span> <span class="p">(</span><span class="n">c</span><span class="p">,</span><span class="n">s1</span><span class="p">)</span> <span class="ow">&lt;-</span> <span class="n">this</span>
                                  <span class="n">return</span> <span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="kt">Scanner</span> <span class="p">(</span><span class="n">next</span> <span class="n">s1</span><span class="p">)</span> <span class="n">next</span><span class="p">)</span></pre></div>
        </div>
        <div class='clearall'></div>
    </section>
    </div>
    <div class='section'>
    <a id="section-3" class="section-anchor"></a>
    <section>
        <div class='docs'>
          <div class='octowrap'>
            <a class='octothorpe' href='#section-3'>#</a>
          </div>
          <h2><a id="lexer" class="header-anchor" href="#lexer"> Lexer </a></h2>
        </div>
        <div class='code'>
          <div class="highlight"><pre><span class="kr">type</span> <span class="kt">LChar</span>              <span class="ow">=</span> <span class="p">(</span><span class="kt">Line</span><span class="p">,</span><span class="kt">Char</span><span class="p">)</span>
<span class="kr">type</span> <span class="kt">LString</span>            <span class="ow">=</span> <span class="p">[</span><span class="kt">LChar</span><span class="p">]</span>
<span class="kr">data</span> <span class="kt">Token</span>              <span class="ow">=</span> <span class="kt">TokStart</span> <span class="kt">Line</span> <span class="kt">QName</span> <span class="p">[</span><span class="kt">Attr</span><span class="p">]</span> <span class="kt">Bool</span>  <span class="c1">-- is empty?</span>
                        <span class="o">|</span> <span class="kt">TokEnd</span> <span class="kt">Line</span> <span class="kt">QName</span>
                        <span class="o">|</span> <span class="kt">TokCRef</span> <span class="kt">String</span>
                        <span class="o">|</span> <span class="kt">TokText</span> <span class="kt">CData</span>
                          <span class="kr">deriving</span> <span class="kt">Show</span>

<span class="nf">tokens</span>             <span class="ow">::</span> <span class="kt">XmlSource</span> <span class="n">source</span> <span class="ow">=&gt;</span> <span class="n">source</span> <span class="ow">-&gt;</span> <span class="p">[</span><span class="kt">Token</span><span class="p">]</span>
<span class="nf">tokens</span> <span class="ow">=</span> <span class="n">tokens&#39;</span> <span class="o">.</span> <span class="n">linenumber</span> <span class="mi">1</span>

<span class="nf">tokens&#39;</span> <span class="ow">::</span> <span class="kt">LString</span> <span class="ow">-&gt;</span> <span class="p">[</span><span class="kt">Token</span><span class="p">]</span>
<span class="nf">tokens&#39;</span> <span class="p">((</span><span class="kr">_</span><span class="p">,</span><span class="sc">&#39;&lt;&#39;</span><span class="p">)</span> <span class="kt">:</span> <span class="n">c</span><span class="o">@</span><span class="p">(</span><span class="kr">_</span><span class="p">,</span><span class="sc">&#39;!&#39;</span><span class="p">)</span> <span class="kt">:</span> <span class="n">cs</span><span class="p">)</span> <span class="ow">=</span> <span class="n">special</span> <span class="n">c</span> <span class="n">cs</span>

<span class="nf">tokens&#39;</span> <span class="p">((</span><span class="kr">_</span><span class="p">,</span><span class="sc">&#39;&lt;&#39;</span><span class="p">)</span> <span class="kt">:</span> <span class="n">cs</span><span class="p">)</span>   <span class="ow">=</span> <span class="n">tag</span> <span class="p">(</span><span class="n">dropSpace</span> <span class="n">cs</span><span class="p">)</span> <span class="c1">-- we are being nice here</span>
<span class="nf">tokens&#39;</span> <span class="kt">[]</span> <span class="ow">=</span> <span class="kt">[]</span>
<span class="nf">tokens&#39;</span> <span class="n">cs</span><span class="o">@</span><span class="p">((</span><span class="n">l</span><span class="p">,</span><span class="kr">_</span><span class="p">)</span><span class="kt">:</span><span class="kr">_</span><span class="p">)</span> <span class="ow">=</span> <span class="kr">let</span> <span class="p">(</span><span class="n">as</span><span class="p">,</span><span class="n">bs</span><span class="p">)</span> <span class="ow">=</span> <span class="n">breakn</span> <span class="p">(</span><span class="sc">&#39;&lt;&#39;</span> <span class="o">==</span><span class="p">)</span> <span class="n">cs</span>
                       <span class="kr">in</span> <span class="n">map</span> <span class="n">cvt</span> <span class="p">(</span><span class="n">decode_text</span> <span class="n">as</span><span class="p">)</span> <span class="o">++</span> <span class="n">tokens&#39;</span> <span class="n">bs</span></pre></div>
        </div>
        <div class='clearall'></div>
    </section>
    </div>
    <div class='section'>
    <a id="section-4" class="section-anchor"></a>
    <section>
        <div class='docs'>
          <div class='octowrap'>
            <a class='octothorpe' href='#section-4'>#</a>
          </div>
          <p><span class=warning><strong>WARNING</strong>: Note, some of the lines might be a bit inacuarate</span></p>
        </div>
        <div class='code'>
          <div class="highlight"><pre>  <span class="kr">where</span> <span class="n">cvt</span> <span class="p">(</span><span class="kt">TxtBit</span> <span class="n">x</span><span class="p">)</span>  <span class="ow">=</span> <span class="kt">TokText</span> <span class="kt">CData</span> <span class="p">{</span> <span class="n">cdLine</span> <span class="ow">=</span> <span class="kt">Just</span> <span class="n">l</span>
                                        <span class="p">,</span> <span class="n">cdVerbatim</span> <span class="ow">=</span> <span class="kt">CDataText</span>
                                        <span class="p">,</span> <span class="n">cdData</span> <span class="ow">=</span> <span class="n">x</span>
                                        <span class="p">}</span>
        <span class="n">cvt</span> <span class="p">(</span><span class="kt">CRefBit</span> <span class="n">x</span><span class="p">)</span> <span class="ow">=</span> <span class="kr">case</span> <span class="n">cref_to_char</span> <span class="n">x</span> <span class="kr">of</span>
                            <span class="kt">Just</span> <span class="n">c</span> <span class="ow">-&gt;</span> <span class="kt">TokText</span> <span class="kt">CData</span> <span class="p">{</span> <span class="n">cdLine</span> <span class="ow">=</span> <span class="kt">Just</span> <span class="n">l</span>
                                                    <span class="p">,</span> <span class="n">cdVerbatim</span> <span class="ow">=</span> <span class="kt">CDataText</span>
                                                    <span class="p">,</span> <span class="n">cdData</span> <span class="ow">=</span> <span class="p">[</span><span class="n">c</span><span class="p">]</span>
                                                    <span class="p">}</span>
                            <span class="kt">Nothing</span> <span class="ow">-&gt;</span> <span class="kt">TokCRef</span> <span class="n">x</span>


<span class="nf">special</span> <span class="ow">::</span> <span class="kt">LChar</span> <span class="ow">-&gt;</span> <span class="kt">LString</span> <span class="ow">-&gt;</span> <span class="p">[</span><span class="kt">Token</span><span class="p">]</span>
<span class="nf">special</span> <span class="kr">_</span> <span class="p">((</span><span class="kr">_</span><span class="p">,</span><span class="sc">&#39;-&#39;</span><span class="p">)</span> <span class="kt">:</span> <span class="p">(</span><span class="kr">_</span><span class="p">,</span><span class="sc">&#39;-&#39;</span><span class="p">)</span> <span class="kt">:</span> <span class="n">cs</span><span class="p">)</span> <span class="ow">=</span> <span class="n">skip</span> <span class="n">cs</span>
  <span class="kr">where</span> <span class="n">skip</span> <span class="p">((</span><span class="kr">_</span><span class="p">,</span><span class="sc">&#39;-&#39;</span><span class="p">)</span> <span class="kt">:</span> <span class="p">(</span><span class="kr">_</span><span class="p">,</span><span class="sc">&#39;-&#39;</span><span class="p">)</span> <span class="kt">:</span> <span class="p">(</span><span class="kr">_</span><span class="p">,</span><span class="sc">&#39;&gt;&#39;</span><span class="p">)</span> <span class="kt">:</span> <span class="n">ds</span><span class="p">)</span> <span class="ow">=</span> <span class="n">tokens&#39;</span> <span class="n">ds</span>
        <span class="n">skip</span> <span class="p">(</span><span class="kr">_</span> <span class="kt">:</span> <span class="n">ds</span><span class="p">)</span> <span class="ow">=</span> <span class="n">skip</span> <span class="n">ds</span>
        <span class="n">skip</span> <span class="kt">[]</span> <span class="ow">=</span> <span class="kt">[]</span> <span class="c1">-- unterminated comment</span>

<span class="nf">special</span> <span class="n">c</span> <span class="p">((</span><span class="kr">_</span><span class="p">,</span><span class="sc">&#39;[&#39;</span><span class="p">)</span> <span class="kt">:</span> <span class="p">(</span><span class="kr">_</span><span class="p">,</span><span class="sc">&#39;C&#39;</span><span class="p">)</span> <span class="kt">:</span> <span class="p">(</span><span class="kr">_</span><span class="p">,</span><span class="sc">&#39;D&#39;</span><span class="p">)</span> <span class="kt">:</span> <span class="p">(</span><span class="kr">_</span><span class="p">,</span><span class="sc">&#39;A&#39;</span><span class="p">)</span> <span class="kt">:</span> <span class="p">(</span><span class="kr">_</span><span class="p">,</span><span class="sc">&#39;T&#39;</span><span class="p">)</span> <span class="kt">:</span> <span class="p">(</span><span class="kr">_</span><span class="p">,</span><span class="sc">&#39;A&#39;</span><span class="p">)</span> <span class="kt">:</span> <span class="p">(</span><span class="kr">_</span><span class="p">,</span><span class="sc">&#39;[&#39;</span><span class="p">)</span>
         <span class="kt">:</span> <span class="n">cs</span><span class="p">)</span> <span class="ow">=</span>
  <span class="kr">let</span> <span class="p">(</span><span class="n">xs</span><span class="p">,</span><span class="n">ts</span><span class="p">)</span> <span class="ow">=</span> <span class="n">cdata</span> <span class="n">cs</span>
  <span class="kr">in</span> <span class="kt">TokText</span> <span class="kt">CData</span> <span class="p">{</span> <span class="n">cdLine</span> <span class="ow">=</span> <span class="kt">Just</span> <span class="p">(</span><span class="n">fst</span> <span class="n">c</span><span class="p">),</span> <span class="n">cdVerbatim</span> <span class="ow">=</span> <span class="kt">CDataVerbatim</span><span class="p">,</span> <span class="n">cdData</span> <span class="ow">=</span> <span class="n">xs</span> <span class="p">}</span>
                                                                  <span class="kt">:</span> <span class="n">tokens&#39;</span> <span class="n">ts</span>
  <span class="kr">where</span> <span class="n">cdata</span> <span class="p">((</span><span class="kr">_</span><span class="p">,</span><span class="sc">&#39;]&#39;</span><span class="p">)</span> <span class="kt">:</span> <span class="p">(</span><span class="kr">_</span><span class="p">,</span><span class="sc">&#39;]&#39;</span><span class="p">)</span> <span class="kt">:</span> <span class="p">(</span><span class="kr">_</span><span class="p">,</span><span class="sc">&#39;&gt;&#39;</span><span class="p">)</span> <span class="kt">:</span> <span class="n">ds</span><span class="p">)</span> <span class="ow">=</span> <span class="p">(</span><span class="kt">[]</span><span class="p">,</span><span class="n">ds</span><span class="p">)</span>
        <span class="n">cdata</span> <span class="p">((</span><span class="kr">_</span><span class="p">,</span><span class="n">d</span><span class="p">)</span> <span class="kt">:</span> <span class="n">ds</span><span class="p">)</span>  <span class="ow">=</span> <span class="kr">let</span> <span class="p">(</span><span class="n">xs</span><span class="p">,</span><span class="n">ys</span><span class="p">)</span> <span class="ow">=</span> <span class="n">cdata</span> <span class="n">ds</span> <span class="kr">in</span> <span class="p">(</span><span class="n">d</span><span class="kt">:</span><span class="n">xs</span><span class="p">,</span><span class="n">ys</span><span class="p">)</span>
        <span class="n">cdata</span> <span class="kt">[]</span>        <span class="ow">=</span> <span class="p">(</span><span class="kt">[]</span><span class="p">,</span><span class="kt">[]</span><span class="p">)</span>

<span class="nf">special</span> <span class="n">c</span> <span class="n">cs</span> <span class="ow">=</span> 
  <span class="kr">let</span> <span class="p">(</span><span class="n">xs</span><span class="p">,</span><span class="n">ts</span><span class="p">)</span> <span class="ow">=</span> <span class="n">munch</span> <span class="s">&quot;&quot;</span> <span class="mi">0</span> <span class="n">cs</span>
  <span class="kr">in</span> <span class="kt">TokText</span> <span class="kt">CData</span> <span class="p">{</span> <span class="n">cdLine</span> <span class="ow">=</span> <span class="kt">Just</span> <span class="p">(</span><span class="n">fst</span> <span class="n">c</span><span class="p">)</span>
                   <span class="p">,</span> <span class="n">cdVerbatim</span> <span class="ow">=</span> <span class="kt">CDataRaw</span>
                   <span class="p">,</span> <span class="n">cdData</span> <span class="ow">=</span> <span class="sc">&#39;&lt;&#39;</span><span class="kt">:</span><span class="sc">&#39;!&#39;</span><span class="kt">:</span><span class="p">(</span><span class="n">reverse</span> <span class="n">xs</span><span class="p">)</span>
                   <span class="p">}</span> <span class="kt">:</span> <span class="n">tokens&#39;</span> <span class="n">ts</span>
  <span class="kr">where</span> <span class="n">munch</span> <span class="n">acc</span> <span class="n">nesting</span> <span class="p">((</span><span class="kr">_</span><span class="p">,</span><span class="sc">&#39;&gt;&#39;</span><span class="p">)</span> <span class="kt">:</span> <span class="n">ds</span><span class="p">)</span> 
         <span class="o">|</span> <span class="n">nesting</span> <span class="o">==</span> <span class="p">(</span><span class="mi">0</span><span class="ow">::</span><span class="kt">Int</span><span class="p">)</span> <span class="ow">=</span> <span class="p">(</span><span class="sc">&#39;&gt;&#39;</span><span class="kt">:</span><span class="n">acc</span><span class="p">,</span><span class="n">ds</span><span class="p">)</span>
	 <span class="o">|</span> <span class="n">otherwise</span>           <span class="ow">=</span> <span class="n">munch</span> <span class="p">(</span><span class="sc">&#39;&gt;&#39;</span><span class="kt">:</span><span class="n">acc</span><span class="p">)</span> <span class="p">(</span><span class="n">nesting</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="n">ds</span>
        <span class="n">munch</span> <span class="n">acc</span> <span class="n">nesting</span> <span class="p">((</span><span class="kr">_</span><span class="p">,</span><span class="sc">&#39;&lt;&#39;</span><span class="p">)</span> <span class="kt">:</span> <span class="n">ds</span><span class="p">)</span>
	 <span class="ow">=</span> <span class="n">munch</span> <span class="p">(</span><span class="sc">&#39;&lt;&#39;</span><span class="kt">:</span><span class="n">acc</span><span class="p">)</span> <span class="p">(</span><span class="n">nesting</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span> <span class="n">ds</span>
        <span class="n">munch</span> <span class="n">acc</span> <span class="n">n</span> <span class="p">((</span><span class="kr">_</span><span class="p">,</span><span class="n">x</span><span class="p">)</span> <span class="kt">:</span> <span class="n">ds</span><span class="p">)</span> <span class="ow">=</span> <span class="n">munch</span> <span class="p">(</span><span class="n">x</span><span class="kt">:</span><span class="n">acc</span><span class="p">)</span> <span class="n">n</span> <span class="n">ds</span>
        <span class="n">munch</span> <span class="n">acc</span> <span class="kr">_</span> <span class="kt">[]</span> <span class="ow">=</span> <span class="p">(</span><span class="n">acc</span><span class="p">,</span><span class="kt">[]</span><span class="p">)</span> <span class="c1">-- unterminated DTD markup</span></pre></div>
        </div>
        <div class='clearall'></div>
    </section>
    </div>
    <div class='section'>
    <a id="section-5" class="section-anchor"></a>
    <section>
        <div class='docs'>
          <div class='octowrap'>
            <a class='octothorpe' href='#section-5'>#</a>
          </div>
          <p><code>special c cs = tag (c : cs)</code> -- invalid specials are processed as tags</p>
        </div>
        <div class='code'>
          <div class="highlight"><pre><span class="nf">qualName</span>           <span class="ow">::</span> <span class="kt">LString</span> <span class="ow">-&gt;</span> <span class="p">(</span><span class="kt">QName</span><span class="p">,</span><span class="kt">LString</span><span class="p">)</span>
<span class="nf">qualName</span> <span class="n">xs</span>         <span class="ow">=</span> <span class="kr">let</span> <span class="p">(</span><span class="n">as</span><span class="p">,</span><span class="n">bs</span><span class="p">)</span> <span class="ow">=</span> <span class="n">breakn</span> <span class="n">endName</span> <span class="n">xs</span>
                          <span class="p">(</span><span class="n">q</span><span class="p">,</span><span class="n">n</span><span class="p">)</span>   <span class="ow">=</span> <span class="kr">case</span> <span class="n">break</span> <span class="p">(</span><span class="sc">&#39;:&#39;</span><span class="o">==</span><span class="p">)</span> <span class="n">as</span> <span class="kr">of</span>
                                      <span class="p">(</span><span class="n">q1</span><span class="p">,</span><span class="kr">_</span><span class="kt">:</span><span class="n">n1</span><span class="p">)</span> <span class="ow">-&gt;</span> <span class="p">(</span><span class="kt">Just</span> <span class="n">q1</span><span class="p">,</span> <span class="n">n1</span><span class="p">)</span>
                                      <span class="kr">_</span>         <span class="ow">-&gt;</span> <span class="p">(</span><span class="kt">Nothing</span><span class="p">,</span> <span class="n">as</span><span class="p">)</span>
                      <span class="kr">in</span> <span class="p">(</span><span class="kt">QName</span> <span class="p">{</span> <span class="n">qURI</span> <span class="ow">=</span> <span class="kt">Nothing</span><span class="p">,</span> <span class="n">qPrefix</span> <span class="ow">=</span> <span class="n">q</span><span class="p">,</span> <span class="n">qName</span> <span class="ow">=</span> <span class="n">n</span> <span class="p">},</span> <span class="n">bs</span><span class="p">)</span>
  <span class="kr">where</span> <span class="n">endName</span> <span class="n">x</span> <span class="ow">=</span> <span class="n">isSpace</span> <span class="n">x</span> <span class="o">||</span> <span class="n">x</span> <span class="o">==</span> <span class="sc">&#39;=&#39;</span> <span class="o">||</span> <span class="n">x</span> <span class="o">==</span> <span class="sc">&#39;&gt;&#39;</span> <span class="o">||</span> <span class="n">x</span> <span class="o">==</span> <span class="sc">&#39;/&#39;</span>





<span class="nf">tag</span>              <span class="ow">::</span> <span class="kt">LString</span> <span class="ow">-&gt;</span> <span class="p">[</span><span class="kt">Token</span><span class="p">]</span>
<span class="nf">tag</span> <span class="p">((</span><span class="n">p</span><span class="p">,</span><span class="sc">&#39;/&#39;</span><span class="p">)</span> <span class="kt">:</span> <span class="n">cs</span><span class="p">)</span>    <span class="ow">=</span> <span class="kr">let</span> <span class="p">(</span><span class="n">n</span><span class="p">,</span><span class="n">ds</span><span class="p">)</span> <span class="ow">=</span> <span class="n">qualName</span> <span class="p">(</span><span class="n">dropSpace</span> <span class="n">cs</span><span class="p">)</span>
                        <span class="kr">in</span> <span class="kt">TokEnd</span> <span class="n">p</span> <span class="n">n</span> <span class="kt">:</span> <span class="kr">case</span> <span class="p">(</span><span class="n">dropSpace</span> <span class="n">ds</span><span class="p">)</span> <span class="kr">of</span>
                                          <span class="p">(</span><span class="kr">_</span><span class="p">,</span><span class="sc">&#39;&gt;&#39;</span><span class="p">)</span> <span class="kt">:</span> <span class="n">es</span> <span class="ow">-&gt;</span> <span class="n">tokens&#39;</span> <span class="n">es</span></pre></div>
        </div>
        <div class='clearall'></div>
    </section>
    </div>
    <div class='section'>
    <a id="section-6" class="section-anchor"></a>
    <section>
        <div class='docs'>
          <div class='octowrap'>
            <a class='octothorpe' href='#section-6'>#</a>
          </div>
          <p>tag was not properly closed...</p>
        </div>
        <div class='code'>
          <div class="highlight"><pre>                                          <span class="kr">_</span>        <span class="ow">-&gt;</span> <span class="n">tokens&#39;</span> <span class="n">ds</span>
<span class="nf">tag</span> <span class="kt">[]</span>            <span class="ow">=</span> <span class="kt">[]</span>
<span class="nf">tag</span> <span class="n">cs</span>            <span class="ow">=</span> <span class="kr">let</span> <span class="p">(</span><span class="n">n</span><span class="p">,</span><span class="n">ds</span><span class="p">)</span>  <span class="ow">=</span> <span class="n">qualName</span> <span class="n">cs</span>
                        <span class="p">(</span><span class="n">as</span><span class="p">,</span><span class="n">b</span><span class="p">,</span><span class="n">ts</span><span class="p">)</span> <span class="ow">=</span> <span class="n">attribs</span> <span class="p">(</span><span class="n">dropSpace</span> <span class="n">ds</span><span class="p">)</span>
                    <span class="kr">in</span> <span class="kt">TokStart</span> <span class="p">(</span><span class="n">fst</span> <span class="p">(</span><span class="n">head</span> <span class="n">cs</span><span class="p">))</span> <span class="n">n</span> <span class="n">as</span> <span class="n">b</span> <span class="kt">:</span> <span class="n">ts</span>

<span class="nf">attribs</span>          <span class="ow">::</span> <span class="kt">LString</span> <span class="ow">-&gt;</span> <span class="p">([</span><span class="kt">Attr</span><span class="p">],</span> <span class="kt">Bool</span><span class="p">,</span> <span class="p">[</span><span class="kt">Token</span><span class="p">])</span>
<span class="nf">attribs</span> <span class="n">cs</span>        <span class="ow">=</span> <span class="kr">case</span> <span class="n">cs</span> <span class="kr">of</span>
                      <span class="p">(</span><span class="kr">_</span><span class="p">,</span><span class="sc">&#39;&gt;&#39;</span><span class="p">)</span> <span class="kt">:</span> <span class="n">ds</span> <span class="ow">-&gt;</span> <span class="p">(</span><span class="kt">[]</span><span class="p">,</span> <span class="kt">False</span><span class="p">,</span> <span class="n">tokens&#39;</span> <span class="n">ds</span><span class="p">)</span>

                      <span class="p">(</span><span class="kr">_</span><span class="p">,</span><span class="sc">&#39;/&#39;</span><span class="p">)</span> <span class="kt">:</span> <span class="n">ds</span> <span class="ow">-&gt;</span> <span class="p">(</span><span class="kt">[]</span><span class="p">,</span> <span class="kt">True</span><span class="p">,</span> <span class="kr">case</span> <span class="n">ds</span> <span class="kr">of</span>
                                              <span class="p">(</span><span class="kr">_</span><span class="p">,</span><span class="sc">&#39;&gt;&#39;</span><span class="p">)</span> <span class="kt">:</span> <span class="n">es</span> <span class="ow">-&gt;</span> <span class="n">tokens&#39;</span> <span class="n">es</span></pre></div>
        </div>
        <div class='clearall'></div>
    </section>
    </div>
    <div class='section'>
    <a id="section-7" class="section-anchor"></a>
    <section>
        <div class='docs'>
          <div class='octowrap'>
            <a class='octothorpe' href='#section-7'>#</a>
          </div>
          <p>insert missing &gt;  ...</p>
        </div>
        <div class='code'>
          <div class="highlight"><pre>                                              <span class="kr">_</span> <span class="ow">-&gt;</span> <span class="n">tokens&#39;</span> <span class="n">ds</span><span class="p">)</span>

                      <span class="p">(</span><span class="kr">_</span><span class="p">,</span><span class="sc">&#39;?&#39;</span><span class="p">)</span> <span class="kt">:</span> <span class="p">(</span><span class="kr">_</span><span class="p">,</span><span class="sc">&#39;&gt;&#39;</span><span class="p">)</span> <span class="kt">:</span> <span class="n">ds</span> <span class="ow">-&gt;</span> <span class="p">(</span><span class="kt">[]</span><span class="p">,</span> <span class="kt">True</span><span class="p">,</span> <span class="n">tokens&#39;</span> <span class="n">ds</span><span class="p">)</span></pre></div>
        </div>
        <div class='clearall'></div>
    </section>
    </div>
    <div class='section'>
    <a id="section-8" class="section-anchor"></a>
    <section>
        <div class='docs'>
          <div class='octowrap'>
            <a class='octothorpe' href='#section-8'>#</a>
          </div>
          <p>doc ended within a tag..</p>
        </div>
        <div class='code'>
          <div class="highlight"><pre>                      <span class="kt">[]</span>       <span class="ow">-&gt;</span> <span class="p">(</span><span class="kt">[]</span><span class="p">,</span><span class="kt">False</span><span class="p">,</span><span class="kt">[]</span><span class="p">)</span>

                      <span class="kr">_</span>        <span class="ow">-&gt;</span> <span class="kr">let</span> <span class="p">(</span><span class="n">a</span><span class="p">,</span><span class="n">cs1</span><span class="p">)</span> <span class="ow">=</span> <span class="n">attrib</span> <span class="n">cs</span>
                                      <span class="p">(</span><span class="n">as</span><span class="p">,</span><span class="n">b</span><span class="p">,</span><span class="n">ts</span><span class="p">)</span> <span class="ow">=</span> <span class="n">attribs</span> <span class="n">cs1</span>
                                  <span class="kr">in</span> <span class="p">(</span><span class="n">a</span><span class="kt">:</span><span class="n">as</span><span class="p">,</span><span class="n">b</span><span class="p">,</span><span class="n">ts</span><span class="p">)</span>

<span class="nf">attrib</span>             <span class="ow">::</span> <span class="kt">LString</span> <span class="ow">-&gt;</span> <span class="p">(</span><span class="kt">Attr</span><span class="p">,</span><span class="kt">LString</span><span class="p">)</span>
<span class="nf">attrib</span> <span class="n">cs</span>           <span class="ow">=</span> <span class="kr">let</span> <span class="p">(</span><span class="n">ks</span><span class="p">,</span><span class="n">cs1</span><span class="p">)</span>  <span class="ow">=</span> <span class="n">qualName</span> <span class="n">cs</span>
                          <span class="p">(</span><span class="n">vs</span><span class="p">,</span><span class="n">cs2</span><span class="p">)</span>  <span class="ow">=</span> <span class="n">attr_val</span> <span class="p">(</span><span class="n">dropSpace</span> <span class="n">cs1</span><span class="p">)</span>
                      <span class="kr">in</span> <span class="p">((</span><span class="kt">Attr</span> <span class="n">ks</span> <span class="p">(</span><span class="n">decode_attr</span> <span class="n">vs</span><span class="p">)),</span><span class="n">dropSpace</span> <span class="n">cs2</span><span class="p">)</span>

<span class="nf">attr_val</span>           <span class="ow">::</span> <span class="kt">LString</span> <span class="ow">-&gt;</span> <span class="p">(</span><span class="kt">String</span><span class="p">,</span><span class="kt">LString</span><span class="p">)</span>
<span class="nf">attr_val</span> <span class="p">((</span><span class="kr">_</span><span class="p">,</span><span class="sc">&#39;=&#39;</span><span class="p">)</span> <span class="kt">:</span> <span class="n">cs</span><span class="p">)</span> <span class="ow">=</span> <span class="n">string</span> <span class="p">(</span><span class="n">dropSpace</span> <span class="n">cs</span><span class="p">)</span>
<span class="nf">attr_val</span> <span class="n">cs</span>         <span class="ow">=</span> <span class="p">(</span><span class="s">&quot;&quot;</span><span class="p">,</span><span class="n">cs</span><span class="p">)</span>


<span class="nf">dropSpace</span> <span class="ow">::</span> <span class="kt">LString</span> <span class="ow">-&gt;</span> <span class="kt">LString</span>
<span class="nf">dropSpace</span> <span class="ow">=</span> <span class="n">dropWhile</span> <span class="p">(</span><span class="n">isSpace</span> <span class="o">.</span> <span class="n">snd</span><span class="p">)</span></pre></div>
        </div>
        <div class='clearall'></div>
    </section>
    </div>
    <div class='section'>
    <a id="section-9" class="section-anchor"></a>
    <section>
        <div class='docs'>
          <div class='octowrap'>
            <a class='octothorpe' href='#section-9'>#</a>
          </div>
          <div class="haddock">
  <div class="haddock-header">
    Haddock:
  </div>
  <div class="haddock-text">
    <p>Match the value for an attribute. For malformed XML we do our best to guess the programmer's intention.</p>

  </div>

</div>
        </div>
        <div class='code'>
          <div class="highlight"><pre><span class="nf">string</span>             <span class="ow">::</span> <span class="kt">LString</span> <span class="ow">-&gt;</span> <span class="p">(</span><span class="kt">String</span><span class="p">,</span><span class="kt">LString</span><span class="p">)</span>
<span class="nf">string</span> <span class="p">((</span><span class="kr">_</span><span class="p">,</span><span class="sc">&#39;&quot;&#39;</span><span class="p">)</span> <span class="kt">:</span> <span class="n">cs</span><span class="p">)</span>   <span class="ow">=</span> <span class="n">break&#39;</span> <span class="p">(</span><span class="sc">&#39;&quot;&#39;</span> <span class="o">==</span><span class="p">)</span> <span class="n">cs</span></pre></div>
        </div>
        <div class='clearall'></div>
    </section>
    </div>
    <div class='section'>
    <a id="section-10" class="section-anchor"></a>
    <section>
        <div class='docs'>
          <div class='octowrap'>
            <a class='octothorpe' href='#section-10'>#</a>
          </div>
          <p>Allow attributes to be enclosed between ' '.</p>
        </div>
        <div class='code'>
          <div class="highlight"><pre><span class="nf">string</span> <span class="p">((</span><span class="kr">_</span><span class="p">,</span><span class="sc">&#39;</span><span class="se">\&#39;</span><span class="sc">&#39;</span><span class="p">)</span> <span class="kt">:</span> <span class="n">cs</span><span class="p">)</span>  <span class="ow">=</span> <span class="n">break&#39;</span> <span class="p">(</span><span class="sc">&#39;</span><span class="se">\&#39;</span><span class="sc">&#39;</span> <span class="o">==</span><span class="p">)</span> <span class="n">cs</span></pre></div>
        </div>
        <div class='clearall'></div>
    </section>
    </div>
    <div class='section'>
    <a id="section-11" class="section-anchor"></a>
    <section>
        <div class='docs'>
          <div class='octowrap'>
            <a class='octothorpe' href='#section-11'>#</a>
          </div>
          <p>Allow attributes that are not enclosed by anything.</p>
        </div>
        <div class='code'>
          <div class="highlight"><pre><span class="nf">string</span> <span class="n">cs</span>           <span class="ow">=</span> <span class="n">breakn</span> <span class="n">eos</span> <span class="n">cs</span>
  <span class="kr">where</span> <span class="n">eos</span> <span class="n">x</span> <span class="ow">=</span> <span class="n">isSpace</span> <span class="n">x</span> <span class="o">||</span> <span class="n">x</span> <span class="o">==</span> <span class="sc">&#39;&gt;&#39;</span> <span class="o">||</span> <span class="n">x</span> <span class="o">==</span> <span class="sc">&#39;/&#39;</span>


<span class="nf">break&#39;</span> <span class="ow">::</span> <span class="p">(</span><span class="n">a</span> <span class="ow">-&gt;</span> <span class="kt">Bool</span><span class="p">)</span> <span class="ow">-&gt;</span> <span class="p">[(</span><span class="n">b</span><span class="p">,</span><span class="n">a</span><span class="p">)]</span> <span class="ow">-&gt;</span> <span class="p">([</span><span class="n">a</span><span class="p">],[(</span><span class="n">b</span><span class="p">,</span><span class="n">a</span><span class="p">)])</span>
<span class="nf">break&#39;</span> <span class="n">p</span> <span class="n">xs</span>         <span class="ow">=</span> <span class="kr">let</span> <span class="p">(</span><span class="n">as</span><span class="p">,</span><span class="n">bs</span><span class="p">)</span> <span class="ow">=</span> <span class="n">breakn</span> <span class="n">p</span> <span class="n">xs</span>
                      <span class="kr">in</span> <span class="p">(</span><span class="n">as</span><span class="p">,</span> <span class="kr">case</span> <span class="n">bs</span> <span class="kr">of</span>
                                <span class="kt">[]</span> <span class="ow">-&gt;</span> <span class="kt">[]</span>
                                <span class="kr">_</span> <span class="kt">:</span> <span class="n">cs</span> <span class="ow">-&gt;</span> <span class="n">cs</span><span class="p">)</span>

<span class="nf">breakn</span> <span class="ow">::</span> <span class="p">(</span><span class="n">a</span> <span class="ow">-&gt;</span> <span class="kt">Bool</span><span class="p">)</span> <span class="ow">-&gt;</span> <span class="p">[(</span><span class="n">b</span><span class="p">,</span><span class="n">a</span><span class="p">)]</span> <span class="ow">-&gt;</span> <span class="p">([</span><span class="n">a</span><span class="p">],[(</span><span class="n">b</span><span class="p">,</span><span class="n">a</span><span class="p">)])</span>
<span class="nf">breakn</span> <span class="n">p</span> <span class="n">l</span> <span class="ow">=</span> <span class="p">(</span><span class="n">map</span> <span class="n">snd</span> <span class="n">as</span><span class="p">,</span><span class="n">bs</span><span class="p">)</span> <span class="kr">where</span> <span class="p">(</span><span class="n">as</span><span class="p">,</span><span class="n">bs</span><span class="p">)</span> <span class="ow">=</span> <span class="n">break</span> <span class="p">(</span><span class="n">p</span> <span class="o">.</span> <span class="n">snd</span><span class="p">)</span> <span class="n">l</span>



<span class="nf">decode_attr</span> <span class="ow">::</span> <span class="kt">String</span> <span class="ow">-&gt;</span> <span class="kt">String</span>
<span class="nf">decode_attr</span> <span class="n">cs</span> <span class="ow">=</span> <span class="n">concatMap</span> <span class="n">cvt</span> <span class="p">(</span><span class="n">decode_text</span> <span class="n">cs</span><span class="p">)</span>
  <span class="kr">where</span> <span class="n">cvt</span> <span class="p">(</span><span class="kt">TxtBit</span> <span class="n">x</span><span class="p">)</span> <span class="ow">=</span> <span class="n">x</span>
        <span class="n">cvt</span> <span class="p">(</span><span class="kt">CRefBit</span> <span class="n">x</span><span class="p">)</span> <span class="ow">=</span> <span class="kr">case</span> <span class="n">cref_to_char</span> <span class="n">x</span> <span class="kr">of</span>
                            <span class="kt">Just</span> <span class="n">c</span> <span class="ow">-&gt;</span> <span class="p">[</span><span class="n">c</span><span class="p">]</span>
                            <span class="kt">Nothing</span> <span class="ow">-&gt;</span> <span class="sc">&#39;&amp;&#39;</span> <span class="kt">:</span> <span class="n">x</span> <span class="o">++</span> <span class="s">&quot;;&quot;</span>

<span class="kr">data</span> <span class="kt">Txt</span> <span class="ow">=</span> <span class="kt">TxtBit</span> <span class="kt">String</span> <span class="o">|</span> <span class="kt">CRefBit</span> <span class="kt">String</span> <span class="kr">deriving</span> <span class="kt">Show</span>

<span class="nf">decode_text</span> <span class="ow">::</span> <span class="p">[</span><span class="kt">Char</span><span class="p">]</span> <span class="ow">-&gt;</span> <span class="p">[</span><span class="kt">Txt</span><span class="p">]</span>
<span class="nf">decode_text</span> <span class="n">xs</span><span class="o">@</span><span class="p">(</span><span class="sc">&#39;&amp;&#39;</span> <span class="kt">:</span> <span class="n">cs</span><span class="p">)</span> <span class="ow">=</span> <span class="kr">case</span> <span class="n">break</span> <span class="p">(</span><span class="sc">&#39;;&#39;</span> <span class="o">==</span><span class="p">)</span> <span class="n">cs</span> <span class="kr">of</span>
                              <span class="p">(</span><span class="n">as</span><span class="p">,</span><span class="kr">_</span><span class="kt">:</span><span class="n">bs</span><span class="p">)</span> <span class="ow">-&gt;</span> <span class="kt">CRefBit</span> <span class="n">as</span> <span class="kt">:</span> <span class="n">decode_text</span> <span class="n">bs</span>
                              <span class="kr">_</span> <span class="ow">-&gt;</span> <span class="p">[</span><span class="kt">TxtBit</span> <span class="n">xs</span><span class="p">]</span>
<span class="nf">decode_text</span> <span class="kt">[]</span>  <span class="ow">=</span> <span class="kt">[]</span>
<span class="nf">decode_text</span> <span class="n">cs</span>  <span class="ow">=</span> <span class="kr">let</span> <span class="p">(</span><span class="n">as</span><span class="p">,</span><span class="n">bs</span><span class="p">)</span> <span class="ow">=</span> <span class="n">break</span> <span class="p">(</span><span class="sc">&#39;&amp;&#39;</span> <span class="o">==</span><span class="p">)</span> <span class="n">cs</span>
                  <span class="kr">in</span> <span class="kt">TxtBit</span> <span class="n">as</span> <span class="kt">:</span> <span class="n">decode_text</span> <span class="n">bs</span>

<span class="nf">cref_to_char</span> <span class="ow">::</span> <span class="p">[</span><span class="kt">Char</span><span class="p">]</span> <span class="ow">-&gt;</span> <span class="kt">Maybe</span> <span class="kt">Char</span>
<span class="nf">cref_to_char</span> <span class="n">cs</span> <span class="ow">=</span> <span class="kr">case</span> <span class="n">cs</span> <span class="kr">of</span>
  <span class="sc">&#39;#&#39;</span> <span class="kt">:</span> <span class="n">ds</span>  <span class="ow">-&gt;</span> <span class="n">num_esc</span> <span class="n">ds</span>
  <span class="s">&quot;lt&quot;</span>      <span class="ow">-&gt;</span> <span class="kt">Just</span> <span class="sc">&#39;&lt;&#39;</span>
  <span class="s">&quot;gt&quot;</span>      <span class="ow">-&gt;</span> <span class="kt">Just</span> <span class="sc">&#39;&gt;&#39;</span>
  <span class="s">&quot;amp&quot;</span>     <span class="ow">-&gt;</span> <span class="kt">Just</span> <span class="sc">&#39;&amp;&#39;</span>
  <span class="s">&quot;apos&quot;</span>    <span class="ow">-&gt;</span> <span class="kt">Just</span> <span class="sc">&#39;</span><span class="se">\&#39;</span><span class="sc">&#39;</span>
  <span class="s">&quot;quot&quot;</span>    <span class="ow">-&gt;</span> <span class="kt">Just</span> <span class="sc">&#39;&quot;&#39;</span>
  <span class="kr">_</span>         <span class="ow">-&gt;</span> <span class="kt">Nothing</span>

<span class="nf">num_esc</span> <span class="ow">::</span> <span class="kt">String</span> <span class="ow">-&gt;</span> <span class="kt">Maybe</span> <span class="kt">Char</span>
<span class="nf">num_esc</span> <span class="n">cs</span> <span class="ow">=</span> <span class="kr">case</span> <span class="n">cs</span> <span class="kr">of</span>
               <span class="sc">&#39;x&#39;</span> <span class="kt">:</span> <span class="n">ds</span> <span class="ow">-&gt;</span> <span class="n">check</span> <span class="p">(</span><span class="n">readHex</span> <span class="n">ds</span><span class="p">)</span>
               <span class="kr">_</span>        <span class="ow">-&gt;</span> <span class="n">check</span> <span class="p">(</span><span class="n">reads</span> <span class="n">cs</span><span class="p">)</span>

  <span class="kr">where</span> <span class="n">check</span> <span class="p">[(</span><span class="n">n</span><span class="p">,</span><span class="s">&quot;&quot;</span><span class="p">)]</span>  <span class="ow">=</span> <span class="n">cvt_char</span> <span class="n">n</span>
        <span class="n">check</span> <span class="kr">_</span>         <span class="ow">=</span> <span class="kt">Nothing</span>

<span class="nf">cvt_char</span> <span class="ow">::</span> <span class="kt">Int</span> <span class="ow">-&gt;</span> <span class="kt">Maybe</span> <span class="kt">Char</span>
<span class="nf">cvt_char</span> <span class="n">x</span>
  <span class="o">|</span> <span class="n">fromEnum</span> <span class="p">(</span><span class="n">minBound</span> <span class="ow">::</span> <span class="kt">Char</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="n">x</span> <span class="o">&amp;&amp;</span> <span class="n">x</span> <span class="o">&lt;=</span> <span class="n">fromEnum</span> <span class="p">(</span><span class="n">maxBound</span><span class="ow">::</span><span class="kt">Char</span><span class="p">)</span>
                <span class="ow">=</span> <span class="kt">Just</span> <span class="p">(</span><span class="n">toEnum</span> <span class="n">x</span><span class="p">)</span>
  <span class="o">|</span> <span class="n">otherwise</span> <span class="ow">=</span> <span class="kt">Nothing</span>

</pre></div>
        </div>
        <div class='clearall'></div>
    </section>
    </div>
  </div>
</body>
